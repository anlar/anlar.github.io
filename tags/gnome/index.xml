<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Gnome on Блог AnLar</title><link>https://anlar.github.io/tags/gnome/</link><description>Recent content in Gnome on Блог AnLar</description><generator>Hugo</generator><language>ru</language><lastBuildDate>Sat, 18 Jan 2025 20:13:00 +0100</lastBuildDate><atom:link href="https://anlar.github.io/tags/gnome/index.xml" rel="self" type="application/rss+xml"/><item><title>Настройка автоматической смены часового пояса в GNOME 46 (Ubuntu 24.04)</title><link>https://anlar.github.io/2025-01-18-gnome-automatic-timezone/</link><pubDate>Sat, 18 Jan 2025 20:13:00 +0100</pubDate><guid>https://anlar.github.io/2025-01-18-gnome-automatic-timezone/</guid><description>&lt;p>В GNOME есть функция автоматического определения часового пояса системы, что удобно при перемещениях между странами.
К сожалению, в данный момент она сломана и требует некоторых дополнительных действий от пользователя,
чтобы заставить её работать.&lt;/p>
&lt;h2 id="общий-принцип-работы">Общий принцип работы&lt;/h2>
&lt;p>GNOME использует D-Bus сервис &lt;code>geoclue&lt;/code> для получения текущего местоположения системы.
&lt;code>geoclue&lt;/code>, в свою очередь, использует внешний сервис для получения координат по IP и данным Wi-Fi сети.&lt;/p>
&lt;h2 id="включение-смены-часовых-поясов">Включение смены часовых поясов&lt;/h2>
&lt;p>Для начала необходимо включить функцию в настройках GNOME:&lt;/p>
&lt;ol>
&lt;li>В разделе настроек &lt;strong>Date &amp;amp; Time&lt;/strong> - &lt;strong>Automatic Time Zone&lt;/strong>;&lt;/li>
&lt;li>В разделе &lt;strong>Privacy &amp;amp; Security / Location&lt;/strong> - &lt;strong>Automatic Device Location&lt;/strong>.&lt;/li>
&lt;/ol>
&lt;h2 id="настройка-провайдера-геолокации">Настройка провайдера геолокации&lt;/h2>
&lt;p>По умолчанию &lt;code>geoip&lt;/code> использует Mozilla Location Service для получения координат.
Проблема в том, что в 2024 году &lt;a href="https://discourse.mozilla.org/t/retiring-the-mozilla-location-service/128693">этот сервис закрылся&lt;/a>.&lt;/p>
&lt;p>В логах сервиса можно увидеть ошибку при запросе координат:&lt;/p>
&lt;pre tabindex="0">&lt;code>$ journalctl -u geoclue.service
Jan 08 21:12:25 user systemd[1]: Starting geoclue.service - Location Lookup Service...
Jan 08 21:12:25 user systemd[1]: Started geoclue.service - Location Lookup Service.
Jan 08 21:12:33 user geoclue[2278]: Failed to query location: No WiFi networks found
Jan 08 21:12:38 user geoclue[2278]: Failed to query location: Query location SOUP error: Not Found
Jan 08 21:17:41 user geoclue[2278]: Failed to query location: Query location SOUP error: Not Found
Jan 08 21:17:43 user geoclue[2278]: Failed to query location: Query location SOUP error: Not Found
...
&lt;/code>&lt;/pre>&lt;p>&lt;code>geoclue&lt;/code> позволяет самостоятельно настроить URL провайдера геолокации. После закрытия сервиса от Mozilla
остались (и появились) другие альтернативы:&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://beacondb.net/">beaconDB&lt;/a> - бесплатный сервис (обсуждение на &lt;a href="https://news.ycombinator.com/item?id=40895672">Hacker News&lt;/a>);&lt;/li>
&lt;li>&lt;a href="https://developers.google.com/maps/documentation/geolocation/overview">Google Geolocation API&lt;/a> - требует ключа и оплачивается по количеству запросов.&lt;/li>
&lt;/ol>
&lt;p>Для замены будем использовать &lt;strong>beaconDB&lt;/strong>. Нужно добавить в файл конфигурации &lt;code>/etc/geoclue/geoclue.conf&lt;/code> URL нового сервиса:&lt;/p>
&lt;pre tabindex="0">&lt;code>url=https://beacondb.net/v1/geolocate
&lt;/code>&lt;/pre>&lt;p>После чего перезапустить демон &lt;code>geoclue&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code># systemctl restart geoclue.service
&lt;/code>&lt;/pre>&lt;p>На этом всё. Если что-то не заработает, то необходимо проверить логи &lt;code>geoclue&lt;/code> на наличие ошибок.&lt;/p></description></item></channel></rss>